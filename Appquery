select distinct sys.Name0 as 'Hostname',
CASE vch.ClientActiveStatus
WHEN 1 THEN 'Active'
WHEN 0 THEN 'InActive'
Else 'Unknown'
End as 'Client Active Status',
vch.ClientStateDescription ,
CASE
 WHEN dep.EnforcementState >= 1000 and dep.EnforcementState < 2000 THEN 'Success'
 WHEN dep.EnforcementState >= 2000 and dep.EnforcementState < 3000 THEN 'In Progress'
 WHEN dep.EnforcementState >= 4000 and dep.EnforcementState < 5000 THEN 'Unknown'
 WHEN dep.EnforcementState >= 5000 and dep.EnforcementState < 6000 THEN 'Error'
 WHEN dep.EnforcementState >= 3000 and dep.EnforcementState < 4000 THEN 'Requirements Not Met'
Else 'Unknown'
END as 'Error Status',
case when dep.EnforcementState = 1000 then 'Success'
when dep.EnforcementState = 1001 then 'Already Compliant'
when dep.EnforcementState = 1002 then 'Simulate Success'
when dep.EnforcementState = 2000 then 'In Progress'
when dep.EnforcementState = 2001 then 'Waiting for Content'
when dep.EnforcementState = 2002 then 'Installing'
when dep.EnforcementState = 2003 then 'Restart to Continue'
when dep.EnforcementState = 2004 then 'Waiting for maintenance window'
when dep.EnforcementState = 2005 then 'Waiting for schedule'
when dep.EnforcementState = 2006 then 'Downloading dependent content'
when dep.EnforcementState = 2007 then 'Installing dependent content'
when dep.EnforcementState = 2008 then 'Restart to complete'
when dep.EnforcementState = 2009 then 'Content downloaded'
when dep.EnforcementState = 2010 then 'Waiting for update'
when dep.EnforcementState = 2011 then 'Waiting for user session reconnect'
when dep.EnforcementState = 2012 then 'Waiting for user logoff'
when dep.EnforcementState = 2013 then 'Waiting for user logon'
when dep.EnforcementState = 2014 then 'Waiting to install'
when dep.EnforcementState = 2015 then 'Waiting retry'
when dep.EnforcementState = 2016 then 'Waiting for presentation mode'
when dep.EnforcementState = 2017 then 'Waiting for Orchestration'
when dep.EnforcementState = 2018 then 'Waiting for network'
when dep.EnforcementState = 2019 then 'Pending App-V Virtual Environment'
when dep.EnforcementState = 2020 then 'Updating App-V Virtual Environment'
when dep.EnforcementState = 3000 then 'Requirements not met'
when dep.EnforcementState = 3001 then 'Host platform not applicable'
when dep.EnforcementState = 4000 then 'Unknown'
when dep.EnforcementState = 5000 then 'Deployment failed'
when dep.EnforcementState = 5001 then 'Evaluation failed'
when dep.EnforcementState = 5002 then 'Deployment failed'
when dep.EnforcementState = 5003 then 'Failed to locate content'
when dep.EnforcementState = 5004 then 'Dependency installation failed'
when dep.EnforcementState = 5005 then 'Failed to download dependent content'
when dep.EnforcementState = 5006 then 'Conflicts with another application deployment'
when dep.EnforcementState = 5007 then 'Waiting retry'
when dep.EnforcementState = 5008 then 'Failed to uninstall superseded deployment type'
when dep.EnforcementState = 5009 then 'Failed to download superseded deployment type'
when dep.EnforcementState = 5010 then 'Failed to updating App-V Virtual Environment'
Else 'Unknown Enforcement State' 
End as 'State Message',

--dep.EnforcementState,
errdet.ErrorCode,
case errdet.ErrorCode
When -2145124330 then 'Operation tried to install while another installation was in progress or the system was pending a mandatory restart.'
When 1612 then 'The installation source for this product is not available. Verify that the source exists and that you can access it.'
When 60002 then 'Unknown Error (60002)'
When 60008 then 'Unknown Error (60008)'
When 2 then 'The system cannot find the file specified.'
When -2016411129 then 'Parsing Error'
When -2145124330 then 'Other Installation In Progress or Pending Mandatory Restart'
When -2016410847 then 'Evalution Failed:  The script execution has timed out.'
When -2147024895 then 'Incorrect function.'
When -2147217407 then 'Generic failure'
When -2147467260 then 'Operation aborted'
When -2147467259 then 'Unspecified error'
When -2147418113 then 'Catastrophic failure'
When -2147221164 then 'Class not registered'
When -2147220702 then 'Rule is in conflict with other rules'
When -2147217399 then 'Not available'
When -2147217389 then 'Provider load failure'
When -2147213312 then 'Unknown Error (-2147213312)'
When -2147205120 then 'Unknown Error (-2147205120)'
When -2147185721 then 'Unknown Error (-2147185721)'
When -2147024894 then 'The file you specified could not be found. This may be because it is not signed.'
When -2147024784 then 'There is not enough space on the disk.'
When -2147024680 then 'This version of %1 is not compatible with the version of Windows youre running. Check your computer system information to see whether you need a x86 (32-bit) or x64 (64-bit) version of the program, and then contact the software publisher.'
When -2147024156 then 'The requested operation requires elevation.'
When -2147023888 then 'An attempt was made to reference a token that does not exist.'
When -2147023436 then 'This operation returned because the timeout period expired.'
When -2147023278 then 'Another installation is already in progress. Complete that installation before proceeding with this install.'
When -2147017874 then 'The specified session cannot be found.'
When -2146889721 then 'The hash value is not correct.'
When -2146762496 then 'No signature was present in the subject.'
When -2146368439 then 'This operation is not enabled on this platform'
When -2145124329 then 'Operation was not performed because there are no applicable updates.'
When -2068643838 then 'Unknown Error (-2068643838)'
When -2068052310 then 'Unknown Error (-2068052310)'
When -2068052081 then 'Unknown Error (-2068052081)'
When -2067922940 then 'Unknown Error (-2067922940)'
When -2067922408 then 'Unknown Error (-2067922408)'
When -2067919934 then 'Unknown Error (-2067919934)'
When -2016411117 then 'Timeout occurred'
When -2016411012 then 'CI documents download timed out'
When -2016410999 then 'Failed to decompress CI documents'
When -2016410860 then 'CI Version Info timed out.'
When -2016410857 then 'Unknown Error (-2016410857)'
When -2016410850 then 'Unsupported configuration. The application is configured to Install for User but has been targeted to a machine device instead of the user.'
When -2016410844 then 'The application was not detected after installation completed.'
When -2016410843 then 'Application was still detected after uninstall completed.'
When -2016410839 then 'Application requirement evaluation or detection failed'
When -2016410105 then 'Content not found'
When -2016409600 then 'Content transfer manager job is in an unexpected state'
When -2016407290 then 'Failed to verify the executable file is valid or to construct the associated command line.'
When -2016407289 then 'Failed to access all the provided program locations. This program may retry if the maximum retry count has not been reached.'
When -2016407287 then 'Failed to verify that the given file is a valid installation package.'
When -2016407039 then 'The content download cannot be performed because there is not enough available space in cache or the disk is full.'
When -2016407038 then 'The content download cannot be performed because the total size of the client cache is smaller than the size of the requested content.'
When -2016411087 then 'Transient Error'
When -1073741510 then 'Unknown Error (-1073741510)'
When -1073741502 then 'Unknown Error (-1073741502)'
When -1073741205 then 'Unknown Error (-1073741205)'
When -1073740777 then 'Unknown Error (-1073740777)'
When -1072365553 then 'Unknown Error (-1072365553)'
When -805306369 then 'Unknown Error (-805306369)'
When -65536 then 'Unknown Error (-65536)'
When -196608 then 'Unknown Error (-196608)'
When -256 then 'Unknown Error (-256)'
When -3 then 'Unknown Error (-3)'
When -1 then 'Script execution failed with error code -1'
When 0 then 'Success'
When 1 then 'Incorrect function.'
When 5 then 'Access Denied.'
When 7 then 'The storage control blocks were destroyed.'
When 70 then 'The remote server has been paused or is in the process of being started.'
When 83 then 'Fail on INT 24.'
When 90 then 'Unknown Error (90)'
When 99 then 'Unknown Error (99)'
When 112 then 'There is not enough space on the disk.'
When 144 then 'The directory is not a subdirectory of the root directory.'
When 255 then 'The extended attributes are inconsistent.'
When 999 then 'Error performing inpage operation.'
When 1013 then 'The configuration registry key could not be written.'
When 1111 then 'User denied installation.'
When 1335 then 'The subauthority part of a security ID is invalid for this particular use.'
When 1601 then 'The Windows Installer Service could not be accessed. This can occur if the Windows Installer is not correctly installed. Contact your support personnel for assistance.'
When 1602 then 'User cancelled installation.'
When 1603 then 'Fatal error during installation.'
When 1605 then 'This action is only valid for products that are currently installed.'
When 1618 then 'Another installation is already in progress. Complete that installation before proceeding with this install.'
When 1619 then 'This installation package could not be opened. Verify that the package exists and that you can access it, or contact the application vendor to verify that this is a valid Windows Installer package.'
When 1620 then 'This installation package could not be opened. Contact the application vendor to verify that this is a valid Windows Installer package.'
When 1624 then 'Error applying transforms. Verify that the specified transform paths are valid.'
When 1633 then 'This installation package is not supported by this processor type. Contact your product vendor.'
When 1638 then 'Another version of this product is already installed. Installation of this version cannot continue. To configure or remove the existing version of this product, use Add/Remove Programs on the Control Panel.'
When 1645 then 'The Windows Installer does not permit installation from a Remote Desktop Connection.'
When 1706 then 'The endpoint format is invalid.'
When 2222 then 'The resource name could not be found.'
When 2932 then 'Unknown Error (2932)'
When 3333 then 'Unknown Error (3333)'
When 5100 then 'Asia'
When 16008 then 'Unknown Error (16008)'
When 17302 then 'Unknown Error (17302)'
When 17303 then 'Unknown Error (17303)'
When 30015 then 'Unknown Error (30015)'
When 30066 then 'Unknown Error (30066)'
When 30072 then 'Unknown Error (30072)'
When 30086 then 'Unknown Error (30086)'
When 30088 then 'Unknown Error (30088)'
When 40025 then 'Unknown Error (40025)'
When 1073807364 then 'Unknown Error (1073807364)'
Else 'Unknown'
End as 'Error Message',
dep.Descript as 'Deployment Name'
,v_GS_Merck_eCore_Software0.KeyName0, v_GS_Merck_eCore_Software0.Installed0
--,ARP.DisplayName0, ARP.Version0, ARP.InstallDate0
--appdet.CollectionName
from vAppDeploymentResultsPerClient dep
inner join v_R_System sys on dep.ResourceID = sys.ResourceID
inner join v_CH_ClientSummary vch on sys.ResourceID = vch.ResourceID
inner join v_GS_Merck_eCore_Software0 on v_GS_Merck_eCore_Software0.ResourceID = sys.ResourceID
left join vAppDeploymentAssetDetails appdet on (dep.PolicyModelID = appdet.PolicyModelID and dep.ResourceID = appdet.MachineID)
left join vAppDeploymentErrorAssetDetails errdet on (dep.PolicyModelID = errdet.PolicyModelID and dep.ResourceID = errdet.MachineID and errdet.ErrorCode != 0)
--inner join v_Add_Remove_Programs ARP on sys.ResourceID = ARP.ResourceID
where dep.AssignmentID in (
--'16798072', -- CItrix Receiver
--'16796537' --Citrix Workspace
'16798426'
)
and (dep.EnforcementState >= 2000 and dep.EnforcementState < 6000)
and v_GS_Merck_eCore_Software0.KeyName0 = 'Merck_IAC_10.0.3.0_Win10'
--and errdet.ErrorCode is not null
--and errdet.ErrorCode = '-2016410860'
--and ARP.DisplayName0 = 'Qualys Cloud Security Agent'
--select top 100 * from vAppDeploymentResultsPerClient
--where AssignmentID = '16796097'
